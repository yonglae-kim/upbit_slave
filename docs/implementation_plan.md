# 업비트 자동매매 전략 구현 플랜 (순차 실행)

이 문서는 `SR → OB → FVG` 기반 분봉 전략을 저사양 환경에서 안전하게 운영하기 위한 **실행 순서 중심** 계획서입니다.

## 0. 작업 원칙
- 실시간 데이터는 WebSocket 우선, REST는 최소화
- Rate Limit(429/418)와 상태 동기화(myOrder 중심)를 최우선 리스크로 관리
- 저사양 환경을 고려해 종목 수/구독 타입/연산 시점을 제한

## 1단계: 기반 안정화 (우선 시작)
### 1-1. 인증/요청 제어
- [ ] JWT 서명 유틸 정리 (`access_key`, `nonce`, `query_hash`)
- [ ] nonce 충돌 방지 정책(프로세스 재시작 포함) 확정
- [ ] REST 공통 응답에서 `Remaining-Req` 파싱
- [ ] 그룹별 호출 스로틀러(초 단위) 추가
- [ ] 429/418 백오프 정책 공통화

### 1-2. WebSocket 생존성
- [ ] ping/pong 또는 주기 ping 구현
- [ ] 120초 idle timeout 대응 재연결 로직
- [ ] 재연결 후 구독 복원(마켓/타입) 구현
- [ ] SIMPLE/SIMPLE_LIST 포맷 적용 여부 점검

### 1-3. 주문 상태 동기화
- [ ] 주문 API 응답을 "접수"로만 처리
- [ ] `myOrder` 이벤트 기반 상태 머신 확정
- [ ] `myAsset`은 리컨실리에이션 용도로 분리
- [ ] identifier 유일성 정책(재시도 포함) 설계

## 2단계: 데이터/유니버스 파이프라인
### 2-1. 종목 선별
- [ ] `market/all`로 유니버스 구성
- [ ] 24h 거래대금 상위 N1 선별
- [ ] 상대 스프레드 필터 적용
- [ ] 결측률(체결 없는 분봉 누락) 기준 적용
- [ ] 최종 감시 N2(저사양 상한) 확정

### 2-2. 버퍼/정합성
- [ ] 1m/5m/15m 고정 길이 링버퍼 구성
- [ ] 캔들 누락 구간 정렬 정책 정의
- [ ] 지표 계산 트리거를 "캔들 종료 시점"으로 제한

## 3단계: 전략 엔진
### 3-1. SR
- [ ] 피벗 탐지 + 밴드 클러스터링 구현
- [ ] 터치 횟수/최근성/거래대금 기반 SR 스코어링

### 3-2. OB/FVG
- [ ] FVG 3캔들 불균형 탐지
- [ ] FVG 폭(ATR/틱) 및 변위 필터
- [ ] OB(마지막 반대 캔들 + 변위 조건) 구현
- [ ] 존 무효화/만료 규칙 반영

### 3-3. 시그널 결합
- [ ] 15m SR(컨텍스트) + 5m OB/FVG(셋업) + 1m(트리거)
- [ ] 존 충돌 우선순위(OB∩FVG∩SR > 단일) 적용
- [ ] 신호-주문 전 검증(틱 라운딩/최소 주문금액)

## 4단계: 리스크·집행
- [ ] 트레이드당 리스크(%) 기반 포지션 사이징
- [ ] 일손실/연속손실 서킷브레이커
- [ ] 동시 포지션 및 상관 노출 제한
- [ ] 부분익절/손절/트레일링 정책 구현
- [ ] 주문 실패/부분체결 재시도 규칙 구현

## 5단계: 백테스트/검증
- [ ] 캔들 최대 200개 제한 고려한 백필러 점검
- [ ] 수수료+스프레드+슬리피지 비용 모델 반영
- [ ] IS/OOS 분리 + 워크포워드 검증
- [ ] 성과지표(CAGR, MDD, Sharpe, 체결률) 리포트

## 6단계: 운영 전환
- [ ] 페이퍼 트레이딩(최소 1~2주)
- [ ] 알림/모니터링 임계치 튜닝
- [ ] 소액 실거래 점진 전환
- [ ] 장애/손실 이벤트 회고 후 룰 업데이트

---

## 즉시 실행 TODO (이번 사이클)
1. JWT/nonce/Remaining-Req 처리 위치를 코드에서 식별
2. WebSocket 연결 수명(ping/idle/reconnect) 구현 상태 점검
3. 주문 상태를 `myOrder` 중심으로 재정렬할 영향 범위 분석

완료 기준: 위 3개 항목의 현황/갭/개선 우선순위를 문서화하고 다음 커밋에서 구현 착수.
